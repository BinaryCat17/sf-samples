{
    "nodes": [
        { "id": "pos", "type": "Input", "data": {"shape": [2], "dtype": "f32"} },
        { "id": "text", "type": "Input", "data": {"shape": [-1], "dtype": "f32"} },
        { "id": "fontatlas", "type": "Input", "data": {"shape": [262144], "dtype": "f32"} },
        { "id": "fontinfo", "type": "Input", "data": {"shape": [9600], "dtype": "f32"} },
        { "id": "fontsize", "type": "Input", "data": {"shape": [], "dtype": "f32"} },
        { "id": "pixelx", "type": "Input", "data": {"shape": [], "dtype": "f32"} },
        { "id": "pixely", "type": "Input", "data": {"shape": [], "dtype": "f32"} },
        { "id": "idx0", "type": "Const", "data": {"value": 0} },
        { "id": "idx1", "type": "Const", "data": {"value": 1} },
        { "id": "idx2", "type": "Const", "data": {"value": 2} },
        { "id": "idx3", "type": "Const", "data": {"value": 3} },
        { "id": "idx4", "type": "Const", "data": {"value": 4} },
        { "id": "idx7", "type": "Const", "data": {"value": 7} },
        { "id": "eight", "type": "Const", "data": {"value": 8} },
        { "id": "posx", "type": "Gather" },
        { "id": "posy", "type": "Gather" },
        { "id": "dx", "type": "Sub" },
        { "id": "dy", "type": "Sub" },
        { "id": "adv_factor", "type": "Const", "data": {"value": 0.55} },
        { "id": "charw", "type": "Mul" },
        { "id": "charidx_f", "type": "Div" },
        { "id": "charidx", "type": "Floor" },
        
        { "id": "text_len_minus_1", "type": "Const", "data": {"value": 23.0} },
        { "id": "safe_charidx", "type": "Clamp" },

        { "id": "charcode", "type": "Gather" },
        { "id": "base_idx", "type": "Mul" },
        { "id": "u0_idx", "type": "Add" },
        { "id": "v0_idx", "type": "Add" },
        { "id": "u1_idx", "type": "Add" },
        { "id": "v1_idx", "type": "Add" },
        { "id": "yoff_idx", "type": "Add" },
        { "id": "u0", "type": "Gather" },
        { "id": "v0", "type": "Gather" },
        { "id": "u1", "type": "Gather" },
        { "id": "v1", "type": "Gather" },
        { "id": "yoff_b", "type": "Gather" },
        { "id": "baked_size", "type": "Const", "data": {"value": 32.0} },
        { "id": "baseline_ratio", "type": "Const", "data": {"value": 0.75} },
        { "id": "render_scale", "type": "Div" },
        { "id": "yoff_base", "type": "Mul" },
        { "id": "baseline_offset", "type": "Mul" },
        { "id": "yoff_screen", "type": "Add" },
        { "id": "gh_b", "type": "Sub" },
        { "id": "atlas_dim", "type": "Const", "data": {"value": 512.0} },
        { "id": "gh_px", "type": "Mul" },
        { "id": "gh_screen", "type": "Mul" },
        { "id": "rel_y", "type": "Sub" },
        { "id": "localy", "type": "Div" },
        { "id": "localx", "type": "Sub" },
        { "id": "atlasu", "type": "Mix" },
        { "id": "atlasv", "type": "Mix" },
        
        { "id": "zero_f", "type": "Const", "data": {"value": 0.0} },
        { "id": "one_f", "type": "Const", "data": {"value": 1.0} },
        { "id": "safe_atlasu", "type": "Clamp" },
        { "id": "safe_atlasv", "type": "Clamp" },

        { "id": "au_px", "type": "Mul" },
        { "id": "av_px", "type": "Mul" },
        { "id": "au_idx", "type": "Floor" },
        { "id": "av_idx", "type": "Floor" },
        { "id": "rowoff", "type": "Mul" },
        { "id": "flatidx", "type": "Add" },
        
        { "id": "atlas_max_idx", "type": "Const", "data": {"value": 262143.0} },
        { "id": "safe_flatidx", "type": "Clamp" },

        { "id": "sdf", "type": "Gather" },
        { "id": "edges", "type": "Const", "data": {"value": [0.45, 0.55]} },
        { "id": "mask", "type": "SmoothStep" },
        { "id": "zero", "type": "Const", "data": {"value": 0.0} },
        { "id": "one", "type": "Const", "data": {"value": 1.0} },
        { "id": "text_len", "type": "Const", "data": {"value": 24.0} },
        { "id": "is_pos_x", "type": "GreaterEqual" },
        { "id": "is_within_len", "type": "Less" },
        { "id": "is_pos_y", "type": "GreaterEqual" },
        { "id": "is_within_h", "type": "Less" },
        { "id": "valid_x", "type": "And" },
        { "id": "valid_y", "type": "And" },
        { "id": "is_valid", "type": "And" },
        { "id": "final_alpha", "type": "Select" },
        { "id": "alpha", "type": "Output" }
    ],
    "links": [
        { "src": "pixelx", "dst": "dx", "dst_port": "a" },
        { "src": "pos", "dst": "posx", "dst_port": "data" },
        { "src": "idx0", "dst": "posx", "dst_port": "indices" },
        { "src": "posx", "dst": "dx", "dst_port": "b" },
        { "src": "pixely", "dst": "dy", "dst_port": "a" },
        { "src": "pos", "dst": "posy", "dst_port": "data" },
        { "src": "idx1", "dst": "posy", "dst_port": "indices" },
        { "src": "posy", "dst": "dy", "dst_port": "b" },
        { "src": "fontsize", "dst": "charw", "dst_port": "a" },
        { "src": "adv_factor", "dst": "charw", "dst_port": "b" },
        { "src": "dx", "dst": "charidx_f", "dst_port": "a" },
        { "src": "charw", "dst": "charidx_f", "dst_port": "b" },
        { "src": "charidx_f", "dst": "charidx", "dst_port": "x" },
        
        { "src": "charidx", "dst": "safe_charidx", "dst_port": "x" },
        { "src": "zero", "dst": "safe_charidx", "dst_port": "min" },
        { "src": "text_len_minus_1", "dst": "safe_charidx", "dst_port": "max" },

        { "src": "text", "dst": "charcode", "dst_port": "data" },
        { "src": "safe_charidx", "dst": "charcode", "dst_port": "indices" },

        { "src": "charcode", "dst": "base_idx", "dst_port": "a" },
        { "src": "eight", "dst": "base_idx", "dst_port": "b" },
        { "src": "base_idx", "dst": "u0_idx", "dst_port": "a" },
        { "src": "idx1", "dst": "u0_idx", "dst_port": "b" },
        { "src": "base_idx", "dst": "v0_idx", "dst_port": "a" },
        { "src": "idx2", "dst": "v0_idx", "dst_port": "b" },
        { "src": "base_idx", "dst": "u1_idx", "dst_port": "a" },
        { "src": "idx3", "dst": "u1_idx", "dst_port": "b" },
        { "src": "base_idx", "dst": "v1_idx", "dst_port": "a" },
        { "src": "idx4", "dst": "v1_idx", "dst_port": "b" },
        { "src": "base_idx", "dst": "yoff_idx", "dst_port": "a" },
        { "src": "idx7", "dst": "yoff_idx", "dst_port": "b" },
        { "src": "fontinfo", "dst": "u0", "dst_port": "data" },
        { "src": "u0_idx", "dst": "u0", "dst_port": "indices" },
        { "src": "fontinfo", "dst": "v0", "dst_port": "data" },
        { "src": "v0_idx", "dst": "v0", "dst_port": "indices" },
        { "src": "fontinfo", "dst": "u1", "dst_port": "data" },
        { "src": "u1_idx", "dst": "u1", "dst_port": "indices" },
        { "src": "fontinfo", "dst": "v1", "dst_port": "data" },
        { "src": "v1_idx", "dst": "v1", "dst_port": "indices" },
        { "src": "fontinfo", "dst": "yoff_b", "dst_port": "data" },
        { "src": "yoff_idx", "dst": "yoff_b", "dst_port": "indices" },
        { "src": "fontsize", "dst": "render_scale", "dst_port": "a" },
        { "src": "baked_size", "dst": "render_scale", "dst_port": "b" },
        { "src": "yoff_b", "dst": "yoff_base", "dst_port": "a" },
        { "src": "render_scale", "dst": "yoff_base", "dst_port": "b" },
        { "src": "baseline_ratio", "dst": "baseline_offset", "dst_port": "a" },
        { "src": "fontsize", "dst": "baseline_offset", "dst_port": "b" },
        { "src": "yoff_base", "dst": "yoff_screen", "dst_port": "a" },
        { "src": "baseline_offset", "dst": "yoff_screen", "dst_port": "b" },
        { "src": "v1", "dst": "gh_b", "dst_port": "a" },
        { "src": "v0", "dst": "gh_b", "dst_port": "b" },
        { "src": "gh_b", "dst": "gh_px", "dst_port": "a" },
        { "src": "atlas_dim", "dst": "gh_px", "dst_port": "b" },
        { "src": "gh_px", "dst": "gh_screen", "dst_port": "a" },
        { "src": "render_scale", "dst": "gh_screen", "dst_port": "b" },
        { "src": "dy", "dst": "rel_y", "dst_port": "a" },
        { "src": "yoff_screen", "dst": "rel_y", "dst_port": "b" },
        { "src": "rel_y", "dst": "localy", "dst_port": "a" },
        { "src": "gh_screen", "dst": "localy", "dst_port": "b" },
        { "src": "charidx_f", "dst": "localx", "dst_port": "a" },
        { "src": "charidx", "dst": "localx", "dst_port": "b" },
        { "src": "u0", "dst": "atlasu", "dst_port": "a" },
        { "src": "u1", "dst": "atlasu", "dst_port": "b" },
        { "src": "localx", "dst": "atlasu", "dst_port": "t" },
        { "src": "v0", "dst": "atlasv", "dst_port": "a" },
        { "src": "v1", "dst": "atlasv", "dst_port": "b" },
        { "src": "localy", "dst": "atlasv", "dst_port": "t" },
        
        { "src": "atlasu", "dst": "safe_atlasu", "dst_port": "x" },
        { "src": "zero_f", "dst": "safe_atlasu", "dst_port": "min" },
        { "src": "one_f",  "dst": "safe_atlasu", "dst_port": "max" },
        
        { "src": "atlasv", "dst": "safe_atlasv", "dst_port": "x" },
        { "src": "zero_f", "dst": "safe_atlasv", "dst_port": "min" },
        { "src": "one_f",  "dst": "safe_atlasv", "dst_port": "max" },

        { "src": "safe_atlasu", "dst": "au_px", "dst_port": "a" },
        { "src": "atlas_dim", "dst": "au_px", "dst_port": "b" },
        { "src": "safe_atlasv", "dst": "av_px", "dst_port": "a" },
        { "src": "atlas_dim", "dst": "av_px", "dst_port": "b" },
        { "src": "au_px", "dst": "au_idx", "dst_port": "x" },
        { "src": "av_px", "dst": "av_idx", "dst_port": "x" },
        { "src": "av_idx", "dst": "rowoff", "dst_port": "a" },
        { "src": "atlas_dim", "dst": "rowoff", "dst_port": "b" },
        { "src": "rowoff", "dst": "flatidx", "dst_port": "a" },
        { "src": "au_idx", "dst": "flatidx", "dst_port": "b" },
        
        { "src": "flatidx", "dst": "safe_flatidx", "dst_port": "x" },
        { "src": "zero_f", "dst": "safe_flatidx", "dst_port": "min" },
        { "src": "atlas_max_idx", "dst": "safe_flatidx", "dst_port": "max" },

        { "src": "fontatlas", "dst": "sdf", "dst_port": "data" },
        { "src": "safe_flatidx", "dst": "sdf", "dst_port": "indices" },

        { "src": "sdf", "dst": "mask", "dst_port": "x" },
        { "src": "edges", "dst": "mask", "dst_port": "edges" },
        { "src": "charidx_f", "dst": "is_pos_x", "dst_port": "a" },
        { "src": "zero", "dst": "is_pos_x", "dst_port": "b" },
        { "src": "charidx_f", "dst": "is_within_len", "dst_port": "a" },
        { "src": "text_len", "dst": "is_within_len", "dst_port": "b" },
        { "src": "localy", "dst": "is_pos_y", "dst_port": "a" },
        { "src": "zero", "dst": "is_pos_y", "dst_port": "b" },
        { "src": "localy", "dst": "is_within_h", "dst_port": "a" },
        { "src": "one", "dst": "is_within_h", "dst_port": "b" },
        { "src": "is_pos_x", "dst": "valid_x", "dst_port": "a" },
        { "src": "is_within_len", "dst": "valid_x", "dst_port": "b" },
        { "src": "is_pos_y", "dst": "valid_y", "dst_port": "a" },
        { "src": "is_within_h", "dst": "valid_y", "dst_port": "b" },
        { "src": "valid_x", "dst": "is_valid", "dst_port": "a" },
        { "src": "valid_y", "dst": "is_valid", "dst_port": "b" },
        { "src": "is_valid", "dst": "final_alpha", "dst_port": "cond" },
        { "src": "mask", "dst": "final_alpha", "dst_port": "true" },
        { "src": "zero", "dst": "final_alpha", "dst_port": "false" },
        { "src": "final_alpha", "dst": "alpha", "dst_port": "in" }
    ]
}